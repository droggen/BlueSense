<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>spi.c</title><link rel="stylesheet" type="text/css" href="../styles/main.css"><script type="text/javascript" src="../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.0 (Development Release 08-22-2015) -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="spi"></a><a name="Topic10"></a><div class="CTopic TFile LC first">
 <div class="CTitle">spi</div>
 <div class="CBody"><p>SPI functions.</p><p>This library interfaces with the AVR's SPI interface.</p><p>In order to select the spi peripheral the macro SPI_SELECT and SPI_DESELECT must be defined in spi.h.&nbsp; The functions postfixed by _noselect will not select/deselect the peripheral, while the others will do.</p><p>All the transfer functions wait for the transfer to be completed before returning.</p><p><b>Dependencies</b></p><ul><li><p>None</p></li></ul><p><b>Key functions</b></p><p>The key functions are:</p><ul><li><p>spi_init:						Initialise SPI as Master in mode 0.</p></li><li><p>spi_rw: 						Exchange one byte with an SPI slave.</p></li><li><p>spi_rw_noselect: 				Exchange one byte with an SPI slave.</p></li><li><p>spi_rwn:						Exchanges n bytes with the SPI slave.</p></li><li><p>spi_rwn_noselect: 			Exchanges n bytes with the SPI slave.</p></li><li><p>spi_wn_noselect:				Writes n bytes to an SPI slave without storing the value returned by the slave.</p></li></ul><p><b>Usage in interrupts</b></p><p>These functions can be used in interrupts.&nbsp; However, as the transfer functions are blocking until the transfer is completed, they may be inadequate if time-sensitive interrupts must be serviced.</p><p><b>Possible improvements</b> Communication with some peripherals is sometimes one way only from the master to the slave.&nbsp; In this case, waiting for completion of the transfer at the end of a transfer function may be sub-optimal as no data needs to be read back. In this case, waiting for completion of transfer at the beginning of the transfer function followed by initiation of a new transfer and an immediate return may be more efficient, as the transfer would occur while returning to the caller.</p></div>
</div>

<a name="Functions"></a><a name="Topic11"></a><div class="CTopic TGroup LC">
 <div class="CTitle">Functions</div>
</div>

<a name="spi_init"></a><a name="Topic12"></a><div class="CTopic TFunction LC">
 <div class="CTitle">spi_init</div>
 <div id="NDPrototype12" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> spi_init(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PName last">spidiv</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Initialise SPI as Master in mode 0.</p><p>Remember to set MOSI and SCK output, MISO as input.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">spidiv<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>SPI divider: use one of SPI_DIV_2, SPI_DIV_4, ... SPI_DIV_128</p></td></tr></table></div>
</div>

<a name="spi_rw"></a><a name="Topic13"></a><div class="CTopic TFunction LC">
 <div class="CTitle">spi_rw</div>
 <div id="NDPrototype13" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span> spi_rw(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PName last">data</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Exchange one byte with an SPI slave: sends one byte to the slave and receive one byte from it.</p><p>This function selects the slave prior to the exchange, and deselects it afterwards.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">data<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>byte to send</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">byte</td><td class="CDLDefinition"><p>byte read from the slave</p></td></tr></table></div>
</div>

<a name="spi_rw_noselect"></a><a name="Topic14"></a><div class="CTopic TFunction LC">
 <div class="CTitle">spi_rw_noselect</div>
 <div id="NDPrototype14" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span> spi_rw_noselect(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PName last">data</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Exchange one byte with an SPI slave: sends one byte to the slave and receive one byte from it.</p><p>This function does not select/deselect the slave; this must be done by user code.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">data<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>byte to send</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">byte</td><td class="CDLDefinition"><p>byte read from the slave</p></td></tr></table></div>
</div>

<a name="spi_rwn"></a><a name="Topic15"></a><div class="CTopic TFunction LC">
 <div class="CTitle">spi_rwn</div>
 <div id="NDPrototype15" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> spi_rwn(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PNamePrefix">*</td><td class="PName last">ptr,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td></td><td class="PName last">n</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Exchanges n bytes with the SPI slave. Sends a n-byte buffer to the slave and receive n bytes from it.</p><p>This function selects the slave prior to the exchange, and deselects it afterwards.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">ptr<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span>*</div></td><td class="CDLDefinition"><p>buffer comprising the data to send to the slave and where the data read from it will be stored</p></td></tr><tr><td class="CDLEntry">n<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>number of bytes to exchange with the slave</p></td></tr></table><div class="CHeading">Returns</div><p>-</p></div>
</div>

<a name="spi_rwn_noselect"></a><a name="Topic16"></a><div class="CTopic TFunction LC">
 <div class="CTitle">spi_rwn_noselect</div>
 <div id="NDPrototype16" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> spi_rwn_noselect(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PNamePrefix">*</td><td class="PName last">ptr,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">short</span>&nbsp;</td><td></td><td class="PName last">n</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Exchanges n bytes with the SPI slave. Sends a n-byte buffer to the slave and receive n bytes from it.</p><p>This function does not select/deselect the slave; this must be done by user code.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">ptr<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span>*</div></td><td class="CDLDefinition"><p>buffer comprising the data to send to the slave and where the data read from it will be stored</p></td></tr><tr><td class="CDLEntry">n<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">short</span></div></td><td class="CDLDefinition"><p>number of bytes to exchange with the slave</p></td></tr></table><div class="CHeading">Returns</div><p>-</p></div>
</div>

<a name="spi_wn_noselect"></a><a name="Topic17"></a><div class="CTopic TFunction LC last">
 <div class="CTitle">spi_wn_noselect</div>
 <div id="NDPrototype17" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> spi_wn_noselect(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PNamePrefix">*</td><td class="PName last">ptr,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">short</span>&nbsp;</td><td></td><td class="PName last">n</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Writes n bytes to an SPI slave without storing the value returned by the slave.</p><p>This function is faster than spi_rwn and spi_rwn_noselect and can be used if the goal is to send data to a slave without expecting data in return.</p><p>This function does not select/deselect the slave; this must be done by user code.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">ptr<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span>*</div></td><td class="CDLDefinition"><p>buffer comprising the data to send to the slave and where the data read from it will be stored</p></td></tr><tr><td class="CDLEntry">n<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">short</span></div></td><td class="CDLDefinition"><p>number of bytes to exchange with the slave</p></td></tr></table><div class="CHeading">Returns</div><p>-</p></div>
</div>

</body></html>