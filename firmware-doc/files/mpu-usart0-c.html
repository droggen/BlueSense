<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>mpu-usart0.c</title><link rel="stylesheet" type="text/css" href="../styles/main.css"><script type="text/javascript" src="../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.0 (Development Release 08-22-2015) -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="mpu-usart0.c"></a><a name="Topic104"></a><div class="CTopic TFile LC first">
 <div class="CTitle">mpu-usart0.c</div>
 <div class="CBody"><p>Low-level register access functions to the MPU registers over the SPI interface (using spi-usart0).</p><p>The key functions are:</p><ul><li><p>mpu_writereg:	writes one register. Waits for peripheral available before start, waits for completion. Do not use in interrupts.</p></li><li><p>mpu_readreg: reads one register. Waits for peripheral available before start, waits for completion. Do not use in interrupts.</p></li><li><p>mpu_readreg16: reads a 16-bit register. Waits for peripheral available before start, waits for completion. Do not use in interrupt.</p></li><li><p>mpu_readregs: reads several registers. Waits for peripheral available before start, waits for completion. Do not use in interrupts.</p></li><li><p>mpu_readregs_int: reads several registers using interrupts (faster). Waits for peripheral available before start, waits for completion. Do not use in interrupts.</p></li><li><p>mpu_readregs_int_cb: reads several registers using interrupts. Returns if peripheral not available, calls a callback on transfer completion. Interrupt safe.</p></li></ul><p>All functions will wait for the peripheral to be available, except mpu_readregs_int_cb which will return immediately with an error if the peripheral is used. This allows calls to all functions to be mixed from main code or interrupts (within interrupts only mpu_readregs_int_cb is allowed).</p></div>
</div>

<a name="Functions"></a><a name="Topic105"></a><div class="CTopic TGroup LC">
 <div class="CTitle">Functions</div>
</div>

<a name="mpu_writereg"></a><a name="Topic106"></a><div class="CTopic TFunction LC">
 <div class="CTitle">mpu_writereg</div>
 <div id="NDPrototype106" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> mpu_writereg(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PName last">reg,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PName last">v</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Writes an MPU register.</p><p>Do not call from an interrupt.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">reg<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>Register to write data to</p></td></tr><tr><td class="CDLEntry">v<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>Data to write in register</p></td></tr></table></div>
</div>

<a name="mpu_readreg"></a><a name="Topic107"></a><div class="CTopic TFunction LC">
 <div class="CTitle">mpu_readreg</div>
 <div id="NDPrototype107" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span> mpu_readreg(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PName last">reg</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Reads an 8-bit MPU register.</p><p>Do not call from an interrupt.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">reg<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>Register to read data from</p></td></tr></table></div>
</div>

<a name="mpu_readreg16"></a><a name="Topic96"></a><div class="CTopic TFunction LC">
 <div class="CTitle">mpu_readreg16</div>
 <div id="NDPrototype96" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">short</span> mpu_readreg16(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PName last">reg</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Reads a 16-bit MPU register.</p><p>Do not call from an interrupt.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">reg<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>First register to read data from; the next 8 bits are read from register reg+1</p></td></tr></table></div>
</div>

<a name="mpu_readregs"></a><a name="Topic109"></a><div class="CTopic TFunction LC">
 <div class="CTitle">mpu_readregs</div>
 <div id="NDPrototype109" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> mpu_readregs(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PNamePrefix">*</td><td class="PName last">d,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td></td><td class="PName last">reg,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td></td><td class="PName last">n</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Reads several MPU registers.</p><p>Do not call from an interrupt.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">d<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span>*</div></td><td class="CDLDefinition"><p>Buffer receiving the register data</p></td></tr><tr><td class="CDLEntry">reg<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>First register to read data from</p></td></tr><tr><td class="CDLEntry">n<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>Number of registers to read Returns: Bla</p></td></tr></table></div>
</div>

<a name="mpu_readregs_int"></a><a name="Topic110"></a><div class="CTopic TFunction LC">
 <div class="CTitle">mpu_readregs_int</div>
 <div id="NDPrototype110" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> mpu_readregs_int(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PNamePrefix">*</td><td class="PName last">d,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td></td><td class="PName last">reg,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td></td><td class="PName last">n</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Reads several MPU registers using interrupt transfer.&nbsp; Waits until transfer completion.</p><p>This is faster than calling mpu_readregs for transfer size smaller or equal to _MPU_FASTREAD_LIM; for larger transfer the function calls mpu_readregs.</p><p>Do not call from an interrupt.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">d<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span>*</div></td><td class="CDLDefinition"><p>Buffer receiving the register data</p></td></tr><tr><td class="CDLEntry">reg<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>First register to read data from</p></td></tr><tr><td class="CDLEntry">n<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>Number of registers to read</p></td></tr></table></div>
</div>

<a name="mpu_readregs_int_try_raw"></a><a name="Topic123"></a><div class="CTopic TFunction LC">
 <div class="CTitle">mpu_readregs_int_try_raw</div>
 <div id="NDPrototype123" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span> mpu_readregs_int_try_raw(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PNamePrefix">*</td><td class="PName last">d,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td></td><td class="PName last">reg,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td></td><td class="PName last">n</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Reads several MPU registers using polling. Waits until transfer completion.</p><p>Suitable for calls from interrupts.</p><p>Note that d must be an n+1 buffer, and the first register read will be stored at d[1].</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">d<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span>*</div></td><td class="CDLDefinition"><p>Buffer receiving the register data; this must be a n+1 bytes register</p></td></tr><tr><td class="CDLEntry">reg<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>First register to read data from</p></td></tr><tr><td class="CDLEntry">n<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>Number of registers to read</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">0</td><td class="CDLDefinition"><p>Success</p></td></tr><tr><td class="CDLEntry">1</td><td class="CDLDefinition"><p>Error: transaction too large or peripheral busy</p></td></tr></table></div>
</div>

<a name="mpu_readregs_int_cb"></a><a name="Topic278"></a><div class="CTopic TFunction LC">
 <div class="CTitle">mpu_readregs_int_cb</div>
 <div id="NDPrototype278" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span> mpu_readregs_int_cb(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PNamePrefix">*</td><td class="PName last">d,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td></td><td class="PName last">reg,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td></td><td class="PName last">n,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">void</span>&nbsp;</td><td class="PType">(*cb)&nbsp;</td><td class="PNamePrefix">(</td><td class="PName last">void)</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Read several MPU registers using interrupt transfer.&nbsp; The maximum transfer size must be smaller or equal to _MPU_FASTREAD_LIM.</p><p>The function returns immediately if another mpu_readregs_int_cb transaction is ongoing. It calls a callback upon completion.</p><p>This function is safe to be called from an interrupt.</p><p>The maximum number of exchanged bytes is _MPU_FASTREAD_LIM.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">d<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span>*</div></td><td class="CDLDefinition"><p>Buffer receiving the register data.</p><p>If d is null, then the received data will be held in the temporary buffer _mpu_tmp_reg.&nbsp; The data in _mpu_tmp_reg must be used within the callback as subsequent transactions will overwrite the results.</p></td></tr><tr><td class="CDLEntry">reg<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>First register to read data from</p></td></tr><tr><td class="CDLEntry">n<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>Number of registers to read</p></td></tr><tr><td class="CDLEntry">cb</td><td class="CDLDefinition"><p>User callback to call when the transaction is completed.&nbsp; The result of the transaction is available in the unsigned char array _mpu_result, which is set to point to d.&nbsp; Returns:</p></td></tr><tr><td class="CDLEntry">0</td><td class="CDLDefinition"><p>Success</p></td></tr><tr><td class="CDLEntry">1</td><td class="CDLDefinition"><p>Error</p></td></tr></table></div>
</div>

<a name="mpu_readregs_int_cb_raw"></a><a name="Topic279"></a><div class="CTopic TFunction LC">
 <div class="CTitle">mpu_readregs_int_cb_raw</div>
 <div id="NDPrototype279" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span> mpu_readregs_int_cb_raw(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td></td><td class="PName last">reg,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td></td><td class="PName last">n,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">void</span>&nbsp;</td><td class="PType">(*cb)&nbsp;</td><td class="PNamePrefix">(</td><td class="PName last">void)</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Read several MPU registers using interrupt transfer.</p><p>This is a &quot;raw&quot; variant of mpu_readregs_int_cb which is slightly faster.</p><p>The result of the register read is in _mpu_tmp_reg must be used within the callback as subsequent transactions will overwrite the results.</p><p>The callback must set _mpu_ongoing=0, otherwise no further transactions are possible.</p><p>The maximum transfer size must be smaller or equal to _MPU_FASTREAD_LIM.</p><p>The function returns immediately if another mpu_readregs_int_cb transaction is ongoing. It calls a callback upon completion.</p><p>This function is safe to be called from an interrupt.</p><p>The maximum number of exchanged bytes is _MPU_FASTREAD_LIM.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">reg<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>First register to read data from</p></td></tr><tr><td class="CDLEntry">n<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>Number of registers to read</p></td></tr><tr><td class="CDLEntry">cb</td><td class="CDLDefinition"><p>User callback to call when the transaction is completed.&nbsp; The result of the transaction is available in the unsigned char array _mpu_result, which is set to point to d.&nbsp; Returns:</p></td></tr><tr><td class="CDLEntry">0</td><td class="CDLDefinition"><p>Success</p></td></tr><tr><td class="CDLEntry">1</td><td class="CDLDefinition"><p>Error</p></td></tr></table></div>
</div>

<a name="mpu_get_agt_int_init"></a><a name="Topic112"></a><div class="CTopic TFunction LC last">
 <div class="CTitle">mpu_get_agt_int_init</div>
 <div id="NDPrototype112" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> mpu_get_agt_int_init(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">void</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>For compatibility with the I2C version of the MPU interface.&nbsp; No need to call this function.</p></div>
</div>

</body></html>