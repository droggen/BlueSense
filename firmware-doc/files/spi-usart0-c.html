<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>spi-usart0.c</title><link rel="stylesheet" type="text/css" href="../styles/main.css"><script type="text/javascript" src="../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.0 (Development Release 08-22-2015) -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="spi-usart0"></a><a name="Topic138"></a><div class="CTopic TFile LC first">
 <div class="CTitle">spi-usart0</div>
 <div class="CBody"><p>Provides functions to handle SPI communication using USART0.</p><p>The key functions are:</p><ul><li><p>spiusart0_init: 		setups usart0 for SPI communication</p></li><li><p>spiusart0_rw:			selects the peripheral and exchanges 1 byte. Waits for peripheral available before start, waits for completion. Do not use in interrupts.</p></li><li><p>spiusart0_rwn:		selects the peripheral and exchanges n byte. Waits for peripheral available before start, waits for completion. Do not use in interrupts.</p></li><li><p>spiusart0_rwn_int:	selects the peripheral and exchanges n byte using interrupt-driven transfer.&nbsp; Waits for peripheral available before start, waits for completion. Do not use in interrupts.</p></li><li><p>spiusart0_rwn_int_cb:	selects the peripheral and exchanges n byte using interrupt-driven transfer. Returns if peripheral not available, calls a callback on transfer completion. Interrupt safe.</p></li></ul><p>The only function safe to call from an interrupt routing is spiusart0_rwn_int_cb. The other functions can cause deadlocks and must not be used in interrupts.</p><p>All functions will wait for the peripheral to be available, except spiusart0_rwn_int_cb which will return immediately with an error if the peripheral is used. This allows calls to all functions to be mixed from main code or interrupts (within interrupts only spiusart0_rwn_int_cb is allowed).</p><p>The peripheral is selected with macros SPIUSART0_SELECT and SPIUSART0_DESELECT. When the assembly ISR is used, the file spi-usart0-isr.S must be modified to handle the select/deselect.</p></div>
</div>

<a name="Functions"></a><a name="Topic9"></a><div class="CTopic TGroup LC">
 <div class="CTitle">Functions</div>
</div>

<a name="spiusart0_init"></a><a name="Topic10"></a><div class="CTopic TFunction LC">
 <div class="CTitle">spiusart0_init</div>
 <div id="NDPrototype10" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> spiusart0_init(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">void</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Initialise USART0 in SPI Master mode.</p></div>
</div>

<a name="_spiusart0_waitavailandreserve"></a><a name="Topic11"></a><div class="CTopic TFunction LC">
 <div class="CTitle">_spiusart0_waitavailandreserve</div>
 <div id="NDPrototype11" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> _spiusart0_waitavailandreserve(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">void</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Waits until no SPI transaction occurs (_spiusart0_ongoing=0) and immediately indicates a transaction is ongoing (_spiusart0_ongoing=1).&nbsp; Interrupts are managed to ensure no interrupt-initiated transaction can sneak in.</p></div>
</div>

<a name="_spiusart0_tryavailandreserve"></a><a name="Topic238"></a><div class="CTopic TFunction LC">
 <div class="CTitle">_spiusart0_tryavailandreserve</div>
 <div id="NDPrototype238" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span> _spiusart0_tryavailandreserve(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">void</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Checks availability of SPI peripheral and reserves it, otherwise returns error.</p><p>Checks that no SPI transaction occurs (_spiusart0_ongoing=0) and immediately indicates a transaction is ongoing (_spiusart0_ongoing=1) and returns success. Otherwise returns error.</p><p>Interrupts are managed to ensure no interrupt-initiated transaction can sneak in.</p><div class="CHeading">Return</div><p>0:		OK, peripheral reserved 1:		Error reserving peripheral</p></div>
</div>

<a name="spiusart0_rw"></a><a name="Topic12"></a><div class="CTopic TFunction LC">
 <div class="CTitle">spiusart0_rw</div>
 <div id="NDPrototype12" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span> spiusart0_rw(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PName last">data</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Select peripheral, read/write 1 byte, deselect peripheral.</p><p>Waits until the SPI interface is available before initiating the transfer, and waits until completion of the transfer before returning.</p><p>Do not call in an interrupt routine as this can lead to a deadlock.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">data<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>Data to send to peripheral</p></td></tr></table><div class="CHeading">Returns</div><p>Data read from peripheral</p></div>
</div>

<a name="spiusart0_rwn"></a><a name="Topic273"></a><div class="CTopic TFunction LC">
 <div class="CTitle">spiusart0_rwn</div>
 <div id="NDPrototype273" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> spiusart0_rwn(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PNamePrefix">*</td><td class="PName last">ptr,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td></td><td class="PName last">n</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Read/write n bytes in the provided buffer.</p><p>Waits until the SPI interface is available before initiating the transfer, and waits until completion of the transfer before returning.</p><p>Do not call in an interrupt routine as this can lead to a deadlock.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">ptr<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span>*</div></td><td class="CDLDefinition"><p>Pointer where the data to send and receive is stored.</p></td></tr><tr><td class="CDLEntry">n<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>Number of bytes to exchange</p></td></tr></table><div class="CHeading">Returns</div><p>-</p></div>
</div>

<a name="spiusart0_rwn_try"></a><a name="Topic274"></a><div class="CTopic TFunction LC">
 <div class="CTitle">spiusart0_rwn_try</div>
 <div id="NDPrototype274" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span> spiusart0_rwn_try(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PNamePrefix">*</td><td class="PName last">ptr,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td></td><td class="PName last">n</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Read/write n bytes in the provided buffer.</p><p>Check if the SPI interface is available, if not returns an error.&nbsp; If the peripheral is available, mark is as used to prevent other functions using it and performs a blocking transfer.&nbsp; The function returns once all the data has been transferred.</p><p>Suitable for use in interrupts.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">ptr<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span>*</div></td><td class="CDLDefinition"><p>Pointer where the data to send and receive is stored.</p></td></tr><tr><td class="CDLEntry">n<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>Number of bytes to exchange</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">0</td><td class="CDLDefinition"><p>Success</p></td></tr><tr><td class="CDLEntry">1</td><td class="CDLDefinition"><p>Error, peripheral not available</p></td></tr></table></div>
</div>

<a name="spiusart0_rwn_int"></a><a name="Topic275"></a><div class="CTopic TFunction LC">
 <div class="CTitle">spiusart0_rwn_int</div>
 <div id="NDPrototype275" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> spiusart0_rwn_int(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PNamePrefix">*</td><td class="PName last">ptr,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td></td><td class="PName last">n</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Read/write n bytes in the provided buffer using interrupts.</p><p>Waits until the SPI interface is available before initiating the transfer, and waits until completion of the transfer before returning.</p><p>Do not call in an interrupt routine as this can lead to a deadlock.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">ptr<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span>*</div></td><td class="CDLDefinition"><p>Pointer where the data to send and receive is stored.</p></td></tr><tr><td class="CDLEntry">n<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>Number of bytes to exchange</p></td></tr><tr><td class="CDLEntry">keepfirstrx</td><td class="CDLDefinition"><p>1 to keep the first received byte. This byte is generally meaningless.&nbsp; 0 to discard the first received byte.&nbsp; By default the first received byte is discarded.&nbsp; Discarding the first received byte is a convenience function but is slightly slower as additional memory copies are incurred.&nbsp; Returns: -</p></td></tr></table></div>
</div>

<a name="spiusart0_isbusy"></a><a name="Topic276"></a><div class="CTopic TFunction LC last">
 <div class="CTitle">spiusart0_isbusy</div>
 <div id="NDPrototype276" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span> spiusart0_isbusy(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">void</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Indicates if an interrupt-driven transaction is ongoing</p></div>
</div>

</body></html>