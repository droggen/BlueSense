<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>ltc2942.c</title><link rel="stylesheet" type="text/css" href="../styles/main.css"><script type="text/javascript" src="../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.0 (Development Release 08-22-2015) -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="ltc2942"></a><a name="Topic175"></a><div class="CTopic TFile LC first">
 <div class="CTitle">ltc2942</div>
 <div class="CBody"><p>LTC2942 functions</p><p>This library interfaces with the LTC2942 gas gauge which allows to measure charge flowing through the battery.</p><p><b>Dependencies</b></p><ul><li><p>I2C library</p></li></ul><p><b>Key functions</b></p><p>The key functions are:</p><ul><li><p>ltc2942_init:					Initialise the LTC2942 to default settings.</p></li><li><p>ltc2942_getcharge:			Returns the charge counter in uAh.</p></li><li><p>ltc2942_getchargectr:			Returns the 16-bit accumulated charge counter.</p></li><li><p>ltc2942_setchargectr:			Sets the 16-bit accumulated charge counter.</p></li><li><p>ltc2942_getvoltage:			Returns the voltage on the battery lead in millivolts.</p></li><li><p>ltc2942_gettemperature:		Returns the LTC2942 temperature in decidegrees (1 unit=0.1?celsius).</p></li><li><p>ltc2942_setadc:				Setups the LTC2942 conversion of voltage and temperature and the charge prescaler.</p></li><li><p>ltc2942_setprescaler:			Setups the LTC2942 charge prescaler.</p></li><li><p>ltc2942_printreg:				Prints the LTC2942 register states to a file.</p></li><li><p>ltc2942_getavgpower: 			Computes the average power consumption in mW</p></li></ul><p><b>Usage in interrupts</b></p><p>None of the functions are suitable to be called from interrupts. Doing so will crash the application.</p></div>
</div>

<a name="Functions"></a><a name="Topic176"></a><div class="CTopic TGroup LC">
 <div class="CTitle">Functions</div>
</div>

<a name="ltc2942_init"></a><a name="Topic177"></a><div class="CTopic TFunction LC">
 <div class="CTitle">ltc2942_init</div>
 <div id="NDPrototype177" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> ltc2942_init(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">void</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Initialise the LTC2942 to default settings: automatic conversion of voltage and temperature, highest charge resolution, charge counter set at mid-point suitable to measure battery charge or discharge.</p><p>With these settings the maximum charge/discharge that can be measured is 21mAh.</p><div class="CHeading">Note</div><p>no error checking on the I2C interface.</p></div>
</div>

<a name="ltc2942_getchargectr"></a><a name="Topic178"></a><div class="CTopic TFunction LC">
 <div class="CTitle">ltc2942_getchargectr</div>
 <div id="NDPrototype178" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">short</span> ltc2942_getchargectr(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">void</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Returns the 16-bit accumulated charge counter.</p><div class="CHeading">Note</div><p>no error checking on the I2C interface.</p><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">Charge</td><td class="CDLDefinition"><p>16-bit accumulated charge</p></td></tr></table></div>
</div>

<a name="ltc2942_getcharge"></a><a name="Topic179"></a><div class="CTopic TFunction LC">
 <div class="CTitle">ltc2942_getcharge</div>
 <div id="NDPrototype179" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">long</span> ltc2942_getcharge(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">void</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Returns the charge counter in uAh.&nbsp; This function takes into account the prescaler of the LTC2942 and converts the charge counter into uAh.</p><p>The maximum value that this function returns is 5'570'475.</p><div class="CHeading">Note</div><p>no error checking on the I2C interface.</p><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">Charge</td><td class="CDLDefinition"><p>Charge in uAh</p></td></tr></table></div>
</div>

<a name="ltc2942_setchargectr"></a><a name="Topic180"></a><div class="CTopic TFunction LC">
 <div class="CTitle">ltc2942_setchargectr</div>
 <div id="NDPrototype180" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span> ltc2942_setchargectr(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">short</span>&nbsp;</td><td class="PName last">charge</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Sets the 16-bit accumulated charge counter.</p><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">0</td><td class="CDLDefinition"><p>Success</p></td></tr><tr><td class="CDLEntry">nonzero</td><td class="CDLDefinition"><p>Error</p></td></tr></table></div>
</div>

<a name="ltc2942_getvoltage"></a><a name="Topic181"></a><div class="CTopic TFunction LC">
 <div class="CTitle">ltc2942_getvoltage</div>
 <div id="NDPrototype181" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">short</span> ltc2942_getvoltage(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">void</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Returns the voltage on the battery lead in millivolts.</p><div class="CHeading">Note</div><p>no error checking on the I2C interface.</p><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">Voltage</td><td class="CDLDefinition"><p>Voltage in millivolts</p></td></tr></table></div>
</div>

<a name="ltc2942_gettemperature"></a><a name="Topic182"></a><div class="CTopic TFunction LC">
 <div class="CTitle">ltc2942_gettemperature</div>
 <div id="NDPrototype182" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">short</span> ltc2942_gettemperature(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">void</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Returns the LTC2942 temperature in decidegrees (1 unit=0.1?celsius).</p><div class="CHeading">Note</div><p>no error checking on the I2C interface.</p><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">Temperature[dd]</td><td class="CDLDefinition"><p>Temperature in decidegrees (1 unit=0.1?celsius)</p></td></tr></table></div>
</div>

<a name="ltc2942_setadc"></a><a name="Topic183"></a><div class="CTopic TFunction LC">
 <div class="CTitle">ltc2942_setadc</div>
 <div id="NDPrototype183" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span> ltc2942_setadc(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PName last">adc</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Setups the LTC2942 ADC conversion of voltage and temperature between single, automatic or disabled.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">adc<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>2-bits indicating: 11:temperature&amp;voltage conversion every second; 10: single voltage conversion; 01: single temperature conversion; 00: no conversion (sleep).</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">0</td><td class="CDLDefinition"><p>Success</p></td></tr><tr><td class="CDLEntry">nonzero</td><td class="CDLDefinition"><p>Error</p></td></tr></table></div>
</div>

<a name="ltc2942_setprescaler"></a><a name="Topic184"></a><div class="CTopic TFunction LC">
 <div class="CTitle">ltc2942_setprescaler</div>
 <div id="NDPrototype184" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span> ltc2942_setprescaler(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PName last">prescaler</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Setups the LTC2942 charge prescaler.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">prescaler<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span></div></td><td class="CDLDefinition"><p>3-bits indicating the prescaler value M between 1 and 128. M = 2^prescaler.</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">0</td><td class="CDLDefinition"><p>Success</p></td></tr><tr><td class="CDLEntry">nonzero</td><td class="CDLDefinition"><p>Error</p></td></tr></table></div>
</div>

<a name="ltc2942_getprescaler"></a><a name="Topic185"></a><div class="CTopic TFunction LC">
 <div class="CTitle">ltc2942_getprescaler</div>
 <div id="NDPrototype185" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">char</span> ltc2942_getprescaler(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">void</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Returns the 3-bit prescaler value.&nbsp; The actual prescaler value M is betweeen 1 and 128: M=2^prescaler.</p><p>This function returns a cached version of the prescaler set with ltc2942_setprescaler.</p><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">prescaler</td><td class="CDLDefinition"><p>3-bit prescaler value</p></td></tr></table></div>
</div>

<a name="ltc2942_printreg"></a><a name="Topic186"></a><div class="CTopic TFunction LC">
 <div class="CTitle">ltc2942_printreg</div>
 <div id="NDPrototype186" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> ltc2942_printreg(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first">FILE&nbsp;</td><td class="PNamePrefix">*</td><td class="PName last">file</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Prints the LTC2942 register states to a file.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">file<div class="CDLParameterType">FILE*</div></td><td class="CDLDefinition"><p>File on which the registers must be printed</p></td></tr></table><div class="CHeading">Returns</div><p>void</p></div>
</div>

<a name="ltc2942_getavgpower"></a><a name="Topic187"></a><div class="CTopic TFunction LC last">
 <div class="CTitle">ltc2942_getavgpower</div>
 <div id="NDPrototype187" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">signed</span> <span class="SHKeyword">long</span> ltc2942_getavgpower(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">long</span>&nbsp;</td><td class="PName last">c1,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">long</span>&nbsp;</td><td class="PName last">c2,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">short</span>&nbsp;</td><td class="PName last">voltage,</td></tr><tr><td class="PModifierQualifier first"><span class="SHKeyword">unsigned</span>&nbsp;</td><td class="PType"><span class="SHKeyword">long</span>&nbsp;</td><td class="PName last">ms</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Computes the average power consumption in mW between two readings of the charge done after a time interval ms.&nbsp; This function assumes that the battery voltage is approximately constant between the first and second charge measure.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">c1<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">long</span></div></td><td class="CDLDefinition"><p>First charge reading in uAh</p></td></tr><tr><td class="CDLEntry">c2<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">long</span></div></td><td class="CDLDefinition"><p>Second charge reading in uAh</p></td></tr><tr><td class="CDLEntry">voltage<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">short</span></div></td><td class="CDLDefinition"><p>Voltage in millivolts</p></td></tr><tr><td class="CDLEntry">ms<div class="CDLParameterType"><span class="SHKeyword">unsigned</span> <span class="SHKeyword">long</span></div></td><td class="CDLDefinition"><p>Time interval between first and second charge readings</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">dq</td><td class="CDLDefinition"><p>Average power in mW</p></td></tr></table></div>
</div>

</body></html>