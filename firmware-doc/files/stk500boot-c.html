<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>stk500boot.c</title><link rel="stylesheet" type="text/css" href="../styles/main.css"><script type="text/javascript" src="../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.0 (Development Release 08-22-2015) -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="STK500v2_compatible_bootloader"></a><a name="Topic1"></a><div class="CTopic TSection LC first">
 <div class="CTitle">STK500v2 compatible bootloader</div>
 <div class="CBody"><p>Modified for Wiring board ATMega128-16MHz Author:&nbsp; Peter Fleury <a href="#" onclick="javascript:location.href='ma\u0069'+'lto\u003a'+'pfl'+'eury'+'\u0040'+'gmx'+'\u002ech';return false;">pfl<span style="display: none">[xxx]</span>eury<span>&#64;</span>gmx<span style="display: none">[xxx]</span>&#46;ch</a>&nbsp; <a href="http://jump.to/fleury" target="_top">http://&#8203;jump&#8203;.to&#8203;/fleury</a> Compiler:&nbsp; avr-gcc 3.4.5 or 4.1 / avr-libc 1.4.3 Hardware:&nbsp; All AVRs with bootloader support, tested with ATmega8 License:&nbsp; GNU General Public License</p><p>Modified:&nbsp; Worapoht Kornkaewwattanakul <a href="#" onclick="javascript:location.href='ma\u0069'+'lto\u003a'+'d'+'ev'+'\u0040'+'avrid'+'e\u002ecom';return false;">d<span style="display: none">[xxx]</span>ev<span>&#64;</span>avrid<span style="display: none">[xxx]</span>e&#46;com</a>&nbsp; <a href="http://www.avride.com" target="_top">http://&#8203;www&#8203;.avride&#8203;.com</a> Date:&nbsp; 17 October 2007 Update:&nbsp; 1st, 29 Dec 2007 : Enable CMD_SPI_MULTI but ignore unused command by return 0x00 byte response..&nbsp; Compiler:&nbsp; WINAVR20060421 Description: add timeout feature like previous Wiring bootloader</p><div class="CHeading">DESCRIPTION</div><p>This program allows an AVR with bootloader capabilities to read/write its own Flash/EEprom. To enter Programming mode an input pin is checked. If this pin is pulled low, programming mode is entered. If not, normal execution is done from $0000 &quot;reset&quot; vector in Application area.&nbsp; Size fits into a 1024 word bootloader section when compiled with avr-gcc 4.1 (direct replace on Wiring Board without fuse setting changed)</p><div class="CHeading">USAGE</div><ul><li><p>Set AVR MCU type and clock-frequency (F_CPU) in the Makefile.</p></li><li><p>Set baud rate below (AVRISP only works with 115200 bps)</p></li><li><p>compile/link the bootloader with the supplied Makefile</p></li><li><p>program the &quot;Boot Flash section size&quot; (BOOTSZ fuses), for boot-size 1024 words:&nbsp; program BOOTSZ01</p></li><li><p>enable the BOOT Reset Vector (program BOOTRST)</p></li><li><p>Upload the hex file to the AVR using any ISP programmer</p></li><li><p>Program Boot Lock Mode 3 (program BootLock 11 and BootLock 12 lock bits) // (leave them)</p></li><li><p>Reset your AVR while keeping PROG_PIN pulled low // (for enter bootloader by switch)</p></li><li><p>Start AVRISP Programmer (AVRStudio/Tools/Program AVR)</p></li><li><p>AVRISP will detect the bootloader</p></li><li><p>Program your application FLASH file and optional EEPROM file using AVRISP</p></li></ul><div class="CHeading">Note</div><p>Erasing the device without flashing, through AVRISP GUI button &quot;Erase Device&quot; is not implemented, due to AVRStudio limitations.&nbsp; Flash is always erased before programming.</p><div class="CHeading">AVRdude</div><p>Please uncomment #define REMOVE_CMD_SPI_MULTI when using AVRdude.&nbsp; Comment #define REMOVE_PROGRAM_LOCK_BIT_SUPPORT to reduce code size Read Fuse Bits and Read/Write Lock Bits is not supported</p><div class="CHeading">NOTES</div><table class="CDefinitionList"><tr><td class="CDLEntry">Based on Atmel Application Note AVR109</td><td class="CDLDefinition"><p>Self-programming</p></td></tr><tr><td class="CDLEntry">Based on Atmel Application Note AVR068</td><td class="CDLDefinition"><p>STK500v2 Protocol</p></td></tr></table><div class="CHeading">LICENSE</div><p>Copyright (C) 2006 Peter Fleury</p><p>This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or any later version.</p><p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&nbsp; See the GNU General Public License for more details.</p></div>
</div>

</body></html>